<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="assets/css/main.css">
</head>
<h1>Chertsey Bourne (Chertsey to River Thames confluence)</h1>
<h2>Ecological Status: <b style="background-color: red;border-radius: 500px;">Poor</b></h2>
<svg id ="svg1" width="440" height="300"></svg>
<h3>Operational Catchment: Wey</h3>
<h3>Managment Catchment: Wey</h3>
<!-- Create a div where the graph will take place -->
<h2 style="text-align: center;">Emotional Index</h2>
<div id="my_dataviz">
    <h3>Historical Emotional Index</h3>
</div>
<div id="my_dataviz1">
    <h3>Emotion Prevelance Distribution</h3>
</div>


<body>
    <style>
   path {
      fill: #ccc;
      stroke: #fff;
      stroke-linejoin: round;
    }
    </style>

    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-array@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-geo@3"></script>



    <script>
        // set the dimensions and margins of the graph
        var margin = {
                top: 10,
                right: 30,
                bottom: 30,
                left: 60
            },
            width = 1200 - margin.left - margin.right,
            height = 400 - margin.top - margin.bottom;

        // append the svg object to the body of the page
        var svg = d3.select("#my_dataviz")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        //Read the data
        d3.csv("https://raw.githubusercontent.com/Digital-Water-Publics/pot-mi/main/pot-mi/p.csv",

            // When reading the csv, I must format variables:
            function (d) {
                return {
                    date: d3.timeParse("%Y-%m-%d %H:%M:%S")(d.created_at),
                    value: d.mean_senti
                }
            },

            // Now I can use this dataset:
            function (data) {

                // Add X axis --> it is a date format
                var x = d3.scaleTime()
                    .domain(d3.extent(data, function (d) {
                        return d.date;
                    }))
                    .range([0, width]);
                svg.append("g")
                    .style("stroke", "white")
                    .style("font-size", "24px")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x));

                // Add Y axis
                var y = d3.scaleLinear()
                    .domain([-5, d3.max(data, function (d) {
                        return +d.value;
                    }) + 2])
                    .range([height, 0]);
                svg.append("g")
                    .style("stroke", "white")
                    .style("font-size", "24px")
                    .call(d3.axisLeft(y));

                // Add the line
                svg.append("path")
                    .datum(data)
                    .attr("fill", "none")
                    .attr("stroke", "steelblue")
                    .attr("stroke-width", 1.5)
                    .attr("d", d3.line()
                        .x(function (d) {
                            return x(d.date)
                        })
                        .y(function (d) {
                            return y(d.value)
                        })
                    )

            })
    </script>


    <script>
        // set the dimensions and margins of the graph
        var margin1 = {
                top: 50,
                right: 00,
                bottom: 00,
                left: 250
            },
            width1 = 600 - margin.left - margin.right,
            height2 = 400 - margin.top - margin.bottom;

        // append the svg object to the body of the page
        var svg1 = d3.select("#my_dataviz1")
            .append("svg")
            .attr("width", width1 + margin1.left + margin1.right)
            .attr("height", height2 + margin1.top + margin1.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin1.left + "," + margin1.top + ")");

        // Parse the Data
        d3.csv("https://raw.githubusercontent.com/Digital-Water-Publics/pot-mi/main/pot-mi/s.csv", function (data) {

            // Add X axis
            var x = d3.scaleLinear()
                .domain([0, 100])
                .range([0, width]);
            svg1.append("g")
                .attr("transform", "translate(0," + height + ")")
                .style("stroke", "white")
                .style("font-size", "24px")
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("transform", "translate(-10,0)rotate(-45)")
                .style("text-anchor", "end");

            // Y axis
            var y = d3.scaleBand()
                .range([0, height])
                .domain(data.map(function (d) {
                    return d.sentiment;
                }))
                .padding(.1);
            svg1.append("g")
                .style("stroke", "white")
                .style("font-size", "24px")
                .call(d3.axisLeft(y))

            //Bars
            svg1.selectAll("myRect")
                .data(data)
                .enter()
                .append("rect")
                .attr("x", x(0))
                .attr("y", function (d) {
                    return y(d.sentiment);
                })
                .attr("width", function (d) {
                    return x(d.percent);
                })
                .attr("height", y.bandwidth())
                .attr("fill", "#69b3a2")


            // .attr("x", function(d) { return x(d.Country); })
            // .attr("y", function(d) { return y(d.Value); })
            // .attr("width", x.bandwidth())
            // .attr("height", function(d) { return height - y(d.Value); })
            // .attr("fill", "#69b3a2")

        })
    </script>

</body>

</html>